<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plan & Chill</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.24.4/babel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" />
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: sans-serif; background: #2a2a2a; }
    input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(1); }
    .transition-colors { transition: background-color 0.15s, color 0.15s; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useMemo } = React;

    // ‚îÄ‚îÄ‚îÄ ICONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const UserIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
    const UserIconLg = () => <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
    const StarIcon = ({ size = 14 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="white" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
    const TrashIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>;
    const EditIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>;
    const BackIcon = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>;

    // ‚îÄ‚îÄ‚îÄ UTILS –î–õ–Ø –ê–õ–ì–û–†–ò–¢–ú–£ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const timeToMins = (timeStr) => {
      if (!timeStr) return 0;
      const [h, m] = timeStr.split(':').map(Number);
      return h * 60 + m;
    };

    const minsToTime = (mins) => {
      const h = Math.floor(mins / 60).toString().padStart(2, '0');
      const m = (mins % 60).toString().padStart(2, '0');
      return `${h}:${m}`;
    };

    // ‚îÄ‚îÄ‚îÄ –í–ò–ö–õ–ò–ö –ë–ï–ö–ï–ù–î–£ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const fetchSchedule = async (tasksForDay) => {
      const converted = tasksForDay.map(t => ({
        ...t,
        startTime: t.startTime ? timeToMins(t.startTime) : null,
        endTime: t.endTime ? timeToMins(t.endTime) : null,
      }));
      try {
        const res = await fetch('http://localhost:8000/plan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tasks: converted, pomodoro_work: 25, pomodoro_break: 5, is_today: false })
        });
        const data = await res.json();
        return data.schedule;
      } catch (e) {
        return tasksForDay;
      }
    };

        // ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function Sidebar({ page, onNavigate, userName, viewMode, onToggleView }) {
      return (
        <div style={{ width: '14rem', background: '#3a3a3a', padding: '1.5rem', display: 'flex', flexDirection: 'column', minHeight: '100vh' }}>
          <button onClick={() => onNavigate('planner')} style={{ color: 'white', fontSize: '1.25rem', fontWeight: 600, marginBottom: '2rem', textAlign: 'left', background: 'none', border: 'none', cursor: 'pointer' }}>
            –ü–ª–∞–Ω–µ—Ä
          </button>

          <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', color: 'white', fontSize: '0.875rem', marginBottom: '1.5rem' }}>
            <div style={{ width: '1.75rem', height: '1.75rem', background: '#9ca3af', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}><UserIcon /></div>
            <span>{userName}</span>
          </div>

          <button onClick={() => onNavigate('settings')} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', color: 'white', fontSize: '0.875rem', marginBottom: '1.5rem', background: page === 'settings' ? '#4a4a4a' : '#5a5a5a', border: 'none', cursor: 'pointer', padding: '0.5rem 0.75rem', borderRadius: '0.25rem', width: '100%', textAlign: 'left' }}>
            <StarIcon size={14} /><span>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span>
          </button>

          {page === 'planner' && (
            <button onClick={onToggleView} style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', color: 'white', fontSize: '0.875rem', background: '#5a5a5a', border: 'none', cursor: 'pointer', padding: '0.5rem 0.75rem', borderRadius: '0.25rem', width: '100%', textAlign: 'left' }}>
              <StarIcon size={14} /><span>{viewMode === 'month' ? '–í–∏–≥–ª—è–¥ –¥–Ω—è' : '–í–∏–≥–ª—è–¥ –º—ñ—Å—è—Ü—è'}</span>
            </button>
          )}
        </div>
      );
    }

    // ‚îÄ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function Login({ onLogin }) {
      const [name, setName] = useState('');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handle = () => {
        if (name && email && password) {
          localStorage.setItem('userName', name);
          localStorage.setItem('userEmail', email);
          localStorage.setItem('userPassword', password);
          onLogin(name);
        } else setError('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è');
      };

      return (
        <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#2a2a2a' }}>
          <div style={{ background: '#d9d9d9', borderRadius: '1.5rem', padding: '3rem', width: '500px', display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
            <h1 style={{ fontSize: '4rem', fontWeight: 700, lineHeight: 1.1, margin: '0 0 2rem 0', textAlign: 'center', color: '#1a1a1a' }}>Plan &<br />Chill</h1>
            <div style={{ width: '100%', maxWidth: '320px', marginBottom: '2rem' }}>
              {['text', 'email', 'password'].map((type, i) => (
                <input key={type} type={type} placeholder={['–í–≤–µ–¥—ñ—Ç—å —ñ–º\'—è', '–í–≤–µ–¥—ñ—Ç—å email', '–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å'][i]} value={[name, email, password][i]} onChange={e => [setName, setEmail, setPassword][i](e.target.value)} onKeyPress={e => e.key === 'Enter' && handle()} style={{ width: '100%', padding: '0.75rem 1rem', border: '1px solid #5a5a5a', borderRadius: '0.5rem', background: '#4a4a4a', color: 'white', marginBottom: '1rem', outline: 'none' }} />
              ))}
              {error && <p style={{ color: '#ef4444', fontSize: '0.875rem', margin: 0, textAlign: 'center' }}>{error}</p>}
            </div>
            <button onClick={handle} style={{ background: '#5a5a5a', color: 'white', padding: '0.75rem 3rem', borderRadius: '9999px', fontSize: '1.125rem', fontWeight: 500, border: 'none', cursor: 'pointer' }}>–£–≤—ñ–π—Ç–∏</button>
          </div>
        </div>
      );
    }

    // ‚îÄ‚îÄ‚îÄ PLANNER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function Planner({ userName, onNavigate }) {
      const [viewMode, setViewMode] = useState('day');
      const [selectedDay, setSelectedDay] = useState(1);
      const [dayTasks, setDayTasks] = useState(() => {
        try { return JSON.parse(localStorage.getItem('dayTasks') || '{}'); } catch { return {}; }
      });
      const [newTaskDay, setNewTaskDay] = useState(null);
      const [editTaskId, setEditTaskId] = useState(null); // –ù–æ–≤–∏–π —Å—Ç–µ–π—Ç –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è

      const [newTaskType, setNewTaskType] = useState('routine');
      const [newTaskEventMode, setNewTaskEventMode] = useState('auto');
      const [newTaskText, setNewTaskText] = useState('');
      const [newTaskStart, setNewTaskStart] = useState('');
      const [newTaskEnd, setNewTaskEnd] = useState('');
      const [newTaskDuration, setNewTaskDuration] = useState('60');
      const [newTaskPriority, setNewTaskPriority] = useState('5');
      const [newTaskRecurrence, setNewTaskRecurrence] = useState('none');
      const [scheduledCache, setScheduledCache] = useState({});

      useEffect(() => {
        const tasks = dayTasks[selectedDay] || [];
        if (tasks.length === 0) { setScheduledCache(prev => ({ ...prev, [selectedDay]: [] })); return; }
        fetchSchedule(tasks).then(result => {
          setScheduledCache(prev => ({ ...prev, [selectedDay]: result }));
        });
      }, [selectedDay, dayTasks]);

      const currentMonth = '–õ—é—Ç–∏–π';
      const daysOfWeek = ['–ü–æ–Ω–µ–¥—ñ–ª–æ–∫', '–í—ñ–≤—Ç–æ—Ä–æ–∫', '–°–µ—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä', '–ü\'—è—Ç–Ω–∏—Ü—è', '–°—É–±–æ—Ç–∞', '–ù–µ–¥—ñ–ª—è'];

      const saveTasks = (tasks) => {
        setDayTasks(tasks);
        localStorage.setItem('dayTasks', JSON.stringify(tasks));
      };

      const addTask = (startDay) => {
        if (!newTaskText.trim()) return;

        const taskObj = {
          id: editTaskId || Date.now().toString(),
          text: newTaskText,
          type: newTaskType,
        };

        if (newTaskType === 'routine') {
          taskObj.startTime = newTaskStart || undefined;
          taskObj.endTime = newTaskEnd || undefined;
        } else {
          taskObj.eventMode = newTaskEventMode;
          if (newTaskEventMode === 'auto') {
            taskObj.duration = newTaskDuration || 60;
            taskObj.priority = parseInt(newTaskPriority) || 1;
          } else {
            taskObj.startTime = newTaskStart || undefined;
            taskObj.endTime = newTaskEnd || undefined;
          }
        }

        let updated = { ...dayTasks };

        if (editTaskId) {
          updated[startDay] = (updated[startDay] || []).map(t => t.id === editTaskId ? taskObj : t);
        } else {
          let daysToAdd = [startDay];

          if (newTaskType === 'routine') {
            if (newTaskRecurrence === 'daily') {
              daysToAdd = Array.from({length: 31 - startDay + 1}, (_, i) => startDay + i);
            } else if (newTaskRecurrence === 'weekly') {
              daysToAdd = [];
              for (let d = startDay; d <= 31; d += 7) daysToAdd.push(d);
            }
          }

          daysToAdd.forEach(d => {
            updated[d] = [...(updated[d] || []), { ...taskObj, id: taskObj.id + '-' + d }];
          });
        }

        saveTasks(updated);
        resetForm();
      };

      const startEdit = (day, task) => {
        setNewTaskType(task.type);
        setNewTaskText(task.text);

        if (task.type === 'routine') {
          setNewTaskStart(task.startTime || '');
          setNewTaskEnd(task.endTime || '');
        } else {
          setNewTaskEventMode(task.eventMode || 'auto');
          if (task.eventMode === 'manual') {
            setNewTaskStart(task.startTime || '');
            setNewTaskEnd(task.endTime || '');
          } else {
            setNewTaskDuration(task.duration || '60');
            setNewTaskPriority(task.priority || '5');
            setNewTaskStart(task.startTime || '');
            setNewTaskEnd(task.endTime || '');
          }
        }

        setNewTaskRecurrence('none');
        setEditTaskId(task.id);
        setNewTaskDay(day);
      };

      const resetForm = () => {
        setNewTaskText(''); setNewTaskStart(''); setNewTaskEnd('');
        setNewTaskDuration('60'); setNewTaskPriority('5'); setNewTaskRecurrence('none');
        setNewTaskEventMode('auto');
        setNewTaskDay(null);
        setEditTaskId(null);
      };

      const removeTask = (day, id) => {
        const updated = { ...dayTasks, [day]: dayTasks[day].filter(t => t.id !== id) };
        saveTasks(updated);
      };

      const getScheduledTasksForDay = (day) => scheduledCache[day] || dayTasks[day] || [];

      return (
        <div style={{ display: 'flex', minHeight: '100vh' }}>
          <Sidebar page="planner" onNavigate={onNavigate} userName={userName} viewMode={viewMode} onToggleView={() => setViewMode(v => v === 'month' ? 'day' : 'month')} />

          {viewMode === 'month' ? (
            <div style={{ flex: 1, padding: '1.5rem', overflow: 'auto', display: 'flex', flexDirection: 'column' }}>
              <h2 style={{ color: 'white', fontSize: '1.25rem', marginBottom: '1rem' }}>{currentMonth}</h2>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '0.5rem', marginBottom: '0.5rem' }}>
                {daysOfWeek.map(d => <div key={d} style={{ background: '#5a5a5a', color: 'white', textAlign: 'center', padding: '0.5rem', borderRadius: '0.25rem', fontSize: '0.75rem' }}>{d}</div>)}
              </div>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '0.5rem', flex: 1 }}>
                {Array.from({ length: 31 }, (_, i) => i + 1).map(day => {
                  const daySchedule = getScheduledTasksForDay(day);
                  return (
                    <div key={day} onClick={() => { setSelectedDay(day); setViewMode('day'); }} style={{ background: '#6a6a6a', borderRadius: '0.25rem', padding: '0.5rem', position: 'relative', cursor: 'pointer', display: 'flex', flexDirection: 'column' }}>
                      <div style={{ width: '1.5rem', height: '1.5rem', borderRadius: '50%', background: 'white', color: 'black', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '0.75rem', marginBottom: '0.5rem' }}>{day}</div>
                      <div style={{flex: 1, overflow: 'hidden'}}>
                        {daySchedule.slice(0, 3).map(task => (
                          <div key={task.id} style={{ background: task.type === 'routine' ? '#4b5563' : '#3b82f6', color: 'white', fontSize: '0.65rem', padding: '0.2rem 0.4rem', borderRadius: '0.25rem', marginBottom: '0.25rem', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>
                            {task.startTime} {task.text}
                          </div>
                        ))}
                        {daySchedule.length > 3 && <div style={{ fontSize: '0.65rem', color: '#d1d5db', textAlign: 'center' }}>+{daySchedule.length - 3} —â–µ</div>}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          ) : (
            <div style={{ flex: 1, padding: '1.5rem', overflow: 'auto', display: 'flex', flexDirection: 'column' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1.5rem' }}>
                <button onClick={() => { setSelectedDay(d => Math.max(1, d - 1)); resetForm(); }} style={{ background: '#5a5a5a', color: 'white', border: 'none', cursor: 'pointer', padding: '0.5rem 1rem', borderRadius: '0.25rem' }}>‚Üê</button>
                <h2 style={{ color: 'white', fontSize: '1.5rem', margin: 0 }}>{selectedDay} {currentMonth}, {daysOfWeek[(selectedDay - 1) % 7]}</h2>
                <button onClick={() => { setSelectedDay(d => Math.min(31, d + 1)); resetForm(); }} style={{ background: '#5a5a5a', color: 'white', border: 'none', cursor: 'pointer', padding: '0.5rem 1rem', borderRadius: '0.25rem' }}>‚Üí</button>
              </div>

              <div style={{ background: '#6a6a6a', borderRadius: '0.5rem', padding: '1.5rem', flex: 1 }}>
                {!newTaskDay && (
                  <button onClick={() => { resetForm(); setNewTaskDay(selectedDay); }} style={{ background: '#3b82f6', color: 'white', border: 'none', cursor: 'pointer', padding: '0.75rem 1.5rem', borderRadius: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '1.5rem', fontWeight: 'bold' }}>
                    + –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ–¥—ñ—é –∞–±–æ —Ä—É—Ç–∏–Ω—É
                  </button>
                )}

                {newTaskDay === selectedDay && (
                  <div style={{ background: '#7a7a7a', borderRadius: '0.5rem', padding: '1.5rem', marginBottom: '1.5rem', border: '2px solid #9ca3af' }}>

                    <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1rem' }}>
                      <button onClick={() => setNewTaskType('routine')} style={{ flex: 1, padding: '0.5rem', borderRadius: '0.25rem', border: 'none', cursor: 'pointer', background: newTaskType === 'routine' ? '#4b5563' : '#d1d5db', color: newTaskType === 'routine' ? 'white' : 'black', fontWeight: 'bold' }}>
                        –†—É—Ç–∏–Ω–∞ (—Å—Ç–∞–ª–∏–π —á–∞—Å)
                      </button>
                      <button onClick={() => setNewTaskType('event')} style={{ flex: 1, padding: '0.5rem', borderRadius: '0.25rem', border: 'none', cursor: 'pointer', background: newTaskType === 'event' ? '#3b82f6' : '#d1d5db', color: newTaskType === 'event' ? 'white' : 'black', fontWeight: 'bold' }}>
                        –ü–æ–¥—ñ—è (–≥–Ω—É—á–∫–∞)
                      </button>
                    </div>

                    <input type="text" value={newTaskText} onChange={e => setNewTaskText(e.target.value)} placeholder="–ù–∞–∑–≤–∞..." style={{ width: '100%', padding: '0.75rem', borderRadius: '0.25rem', border: 'none', marginBottom: '1rem', color: 'black' }} />

                    {newTaskType === 'event' && (
                      <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1rem' }}>
                        <button onClick={() => setNewTaskEventMode('auto')} style={{ flex: 1, padding: '0.4rem', borderRadius: '0.25rem', border: '1px solid #3b82f6', cursor: 'pointer', background: newTaskEventMode === 'auto' ? '#3b82f6' : 'transparent', color: 'white', fontSize: '0.875rem' }}>
                          –ê–≤—Ç–æ–ø—ñ–¥–±—ñ—Ä —á–∞—Å—É (–ê–ª–≥–æ—Ä–∏—Ç–º)
                        </button>
                        <button onClick={() => setNewTaskEventMode('manual')} style={{ flex: 1, padding: '0.4rem', borderRadius: '0.25rem', border: '1px solid #3b82f6', cursor: 'pointer', background: newTaskEventMode === 'manual' ? '#3b82f6' : 'transparent', color: 'white', fontSize: '0.875rem' }}>
                          –í–∫–∞–∑–∞—Ç–∏ —á–∞—Å –≤—Ä—É—á–Ω—É
                        </button>
                      </div>
                    )}

                    {newTaskType === 'routine' || (newTaskType === 'event' && newTaskEventMode === 'manual') ? (
                      <div style={{ display: 'flex', gap: '1rem', marginBottom: '1rem' }}>
                        <div style={{ flex: 1 }}>
                          <label style={{ color: 'white', fontSize: '0.875rem', display: 'block', marginBottom: '0.25rem' }}>–ß–∞—Å –ø–æ—á–∞—Ç–∫—É</label>
                          <input type="time" value={newTaskStart} onChange={e => setNewTaskStart(e.target.value)} style={{ width: '100%', padding: '0.5rem', borderRadius: '0.25rem', border: 'none', color: 'black' }} />
                        </div>
                        <div style={{ flex: 1 }}>
                          <label style={{ color: 'white', fontSize: '0.875rem', display: 'block', marginBottom: '0.25rem' }}>–ß–∞—Å –∫—ñ–Ω—Ü—è</label>
                          <input type="time" value={newTaskEnd} onChange={e => setNewTaskEnd(e.target.value)} style={{ width: '100%', padding: '0.5rem', borderRadius: '0.25rem', border: 'none', color: 'black' }} />
                        </div>
                      </div>
                    ) : (
                      <div style={{ display: 'flex', gap: '1rem', marginBottom: '1rem' }}>
                        <div style={{ flex: 1 }}>
                          <label style={{ color: 'white', fontSize: '0.875rem', display: 'block', marginBottom: '0.25rem' }}>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å (—Ö–≤–∏–ª–∏–Ω)</label>
                          <input type="number" value={newTaskDuration} onChange={e => setNewTaskDuration(e.target.value)} placeholder="60" style={{ width: '100%', padding: '0.5rem', borderRadius: '0.25rem', border: 'none', color: 'black' }} />
                        </div>
                        <div style={{ flex: 1 }}>
                          <label style={{ color: 'white', fontSize: '0.875rem', display: 'block', marginBottom: '0.25rem' }}>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç (1-10)</label>
                          <input type="number" min="1" max="10" value={newTaskPriority} onChange={e => setNewTaskPriority(e.target.value)} placeholder="5" style={{ width: '100%', padding: '0.5rem', borderRadius: '0.25rem', border: 'none', color: 'black' }} />
                        </div>
                      </div>
                    )}

                    {/* –ü–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ—Å—Ç—å —Ç—ñ–ª—å–∫–∏ –¥–ª—è –†—É—Ç–∏–Ω —ñ —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ */}
                    {newTaskType === 'routine' && !editTaskId && (
                      <div style={{ marginBottom: '1rem' }}>
                        <label style={{ color: 'white', fontSize: '0.875rem', display: 'block', marginBottom: '0.25rem' }}>–ü–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ—Å—Ç—å</label>
                        <select value={newTaskRecurrence} onChange={e => setNewTaskRecurrence(e.target.value)} style={{ width: '100%', padding: '0.5rem', borderRadius: '0.25rem', border: 'none', color: 'black' }}>
                          <option value="none">–¢—ñ–ª—å–∫–∏ —Å—å–æ–≥–æ–¥–Ω—ñ</option>
                          <option value="daily">–©–æ–¥–Ω—è</option>
                          <option value="weekly">–©–æ—Ç–∏–∂–Ω—è –≤ —Ü–µ–π –¥–µ–Ω—å</option>
                        </select>
                      </div>
                    )}

                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                      <button onClick={() => addTask(selectedDay)} style={{ flex: 1, background: '#10b981', color: 'white', border: 'none', cursor: 'pointer', padding: '0.75rem', borderRadius: '0.25rem', fontWeight: 'bold' }}>
                        {editTaskId ? '–û–Ω–æ–≤–∏—Ç–∏' : '–ó–±–µ—Ä–µ–≥—Ç–∏'}
                      </button>
                      <button onClick={resetForm} style={{ flex: 1, background: '#ef4444', color: 'white', border: 'none', cursor: 'pointer', padding: '0.75rem', borderRadius: '0.25rem' }}>–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    </div>
                  </div>
                )}

                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                  {getScheduledTasksForDay(selectedDay).map(task => (
                    <div key={task.id} style={{ background: task.type === 'routine' ? '#4b5563' : '#3b82f6', color: 'white', borderRadius: '0.5rem', padding: '1rem', display: 'flex', alignItems: 'center', justifyContent: 'space-between', opacity: task.unplaced ? 0.6 : 1, borderLeft: task.isAuto ? '4px solid #f59e0b' : 'none' }}>
                      <div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                          <span style={{ fontSize: '0.75rem', padding: '0.1rem 0.4rem', background: 'rgba(0,0,0,0.2)', borderRadius: '0.25rem', textTransform: 'uppercase', fontWeight: 'bold' }}>
                            {task.type === 'routine' ? '–†—É—Ç–∏–Ω–∞' : '–ü–æ–¥—ñ—è'}
                          </span>
                          <span style={{ fontWeight: 500, fontSize: '1.1rem' }}>{task.text}</span>
                          {task.unplaced && <span style={{ color: '#f87171', fontSize: '0.75rem' }}>(–ù–µ–º–∞—î –≤—ñ–ª—å–Ω–æ–≥–æ —á–∞—Å—É!)</span>}
                        </div>
                        {!task.unplaced && (task.startTime || task.endTime) && (
                          <div style={{ color: '#e5e7eb', fontSize: '0.875rem', marginTop: '0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                            <span>üïí {task.startTime} {task.endTime ? `- ${task.endTime}` : ''}</span>
                            {task.isAuto && <span style={{ color: '#fcd34d', fontSize: '0.75rem' }}>(–ê–≤—Ç–æ)</span>}
                            {task.type === 'event' && task.eventMode === 'manual' && <span style={{ color: '#10b981', fontSize: '0.75rem' }}>(–í—Ä—É—á–Ω—É)</span>}
                          </div>
                        )}
                      </div>
                      <div style={{ display: 'flex', gap: '0.5rem' }}>
                        <button onClick={() => startEdit(selectedDay, task)} style={{ background: '#6b7280', color: 'white', border: 'none', cursor: 'pointer', padding: '0.5rem', borderRadius: '0.25rem' }}>
                          <EditIcon />
                        </button>
                        <button onClick={() => removeTask(selectedDay, task.id)} style={{ background: '#ef4444', color: 'white', border: 'none', cursor: 'pointer', padding: '0.5rem', borderRadius: '0.25rem' }}>
                          <TrashIcon />
                        </button>
                      </div>
                    </div>
                  ))}
                  {!getScheduledTasksForDay(selectedDay).length && <p style={{ color: '#9ca3af', textAlign: 'center', marginTop: '2rem' }}>–ù–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö —Å–ø—Ä–∞–≤ –Ω–∞ —Ü–µ–π –¥–µ–Ω—å</p>}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // ‚îÄ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function Settings({ userName, setUserName, onNavigate }) {
      const [view, setView] = useState('main');
      const [newName, setNewName] = useState('');
      const userEmail = localStorage.getItem('userEmail') || 'email@example.com';
      const userPassword = localStorage.getItem('userPassword') || '********';

      const handleChangeName = () => {
        if (newName.trim()) {
          localStorage.setItem('userName', newName);
          setUserName(newName);
          setNewName('');
          setView('main');
        }
      };

      return (
        <div style={{ display: 'flex', minHeight: '100vh' }}>
          <Sidebar page="settings" onNavigate={onNavigate} userName={userName} viewMode="month" onToggleView={() => {}} />

          <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative' }}>
            <button onClick={() => onNavigate('planner')} style={{ position: 'absolute', top: '2rem', left: '2rem', display: 'flex', alignItems: 'center', gap: '0.5rem', background: '#4a4a4a', color: 'white', border: 'none', padding: '0.75rem 1.25rem', borderRadius: '0.5rem', cursor: 'pointer', fontSize: '1rem', fontWeight: '500' }}>
              <BackIcon /> –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ø–ª–∞–Ω–µ—Ä–∞
            </button>

            <div style={{ background: '#3a3a3a', borderRadius: '1.5rem', padding: '2.5rem', width: '600px' }}>
              {view === 'main' && (
                <>
                  <h2 style={{ color: 'white', fontSize: '1.5rem', fontWeight: 600, textAlign: 'center', marginBottom: '2.5rem' }}>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–∫–∞—É–Ω—Ç—É</h2>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '1.5rem', marginBottom: '2.5rem' }}>
                    <div style={{ width: '5rem', height: '5rem', background: '#d1d5db', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}><UserIconLg /></div>
                    <h3 style={{ color: 'white', fontSize: '1.25rem', margin: 0 }}>{userName}</h3>
                  </div>

                  <button onClick={() => setView('info')} style={{ display: 'flex', alignItems: 'center', gap: '1rem', color: 'white', fontSize: '1.125rem', background: '#5a5a5a', border: 'none', cursor: 'pointer', padding: '0.75rem 1rem', borderRadius: '0.25rem', width: '100%', textAlign: 'left', marginBottom: '1rem' }}>
                    <StarIcon size={18} /><span>–û—Å–æ–±–∏—Å—Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</span>
                  </button>
                  <button onClick={() => setView('changeName')} style={{ display: 'flex', alignItems: 'center', gap: '1rem', color: 'white', fontSize: '1.125rem', background: '#5a5a5a', border: 'none', cursor: 'pointer', padding: '0.75rem 1rem', borderRadius: '0.25rem', width: '100%', textAlign: 'left', marginBottom: '1rem' }}>
                    <StarIcon size={18} /><span>–ó–º—ñ–Ω–∏—Ç–∏ —ñ–º'—è</span>
                  </button>
                  <button onClick={() => onNavigate('login')} style={{ display: 'flex', alignItems: 'center', gap: '1rem', color: 'white', fontSize: '1.125rem', background: '#ef4444', border: 'none', cursor: 'pointer', padding: '0.75rem 1rem', borderRadius: '0.25rem', width: '100%', textAlign: 'left' }}>
                    <StarIcon size={18} /><span>–í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É</span>
                  </button>
                </>
              )}

              {view === 'info' && (
                <>
                  <h2 style={{ color: 'white', fontSize: '1.5rem', fontWeight: 600, textAlign: 'center', marginBottom: '2.5rem' }}>–û—Å–æ–±–∏—Å—Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h2>
                  {[['–Ü–º\'—è', userName], ['Email', userEmail], ['–ü–∞—Ä–æ–ª—å', userPassword]].map(([label, value]) => (
                    <div key={label} style={{ background: '#5a5a5a', borderRadius: '0.5rem', padding: '1rem', marginBottom: '1.5rem' }}>
                      <div style={{ color: '#d1d5db', fontSize: '0.875rem', marginBottom: '0.25rem' }}>{label}</div>
                      <div style={{ color: 'white', fontSize: '1.125rem' }}>{value}</div>
                    </div>
                  ))}
                  <button onClick={() => setView('main')} style={{ background: '#5a5a5a', color: 'white', border: 'none', cursor: 'pointer', padding: '0.75rem 1.5rem', borderRadius: '0.25rem', width: '100%', fontSize: '1.125rem' }}>–ù–∞–∑–∞–¥</button>
                </>
              )}

              {view === 'changeName' && (
                <>
                  <h2 style={{ color: 'white', fontSize: '1.5rem', fontWeight: 600, textAlign: 'center', marginBottom: '2.5rem' }}>–ó–º—ñ–Ω–∏—Ç–∏ —ñ–º'—è</h2>
                  <div style={{ color: '#d1d5db', fontSize: '0.875rem', marginBottom: '0.5rem' }}>–ü–æ—Ç–æ—á–Ω–µ —ñ–º'—è</div>
                  <div style={{ background: '#5a5a5a', borderRadius: '0.5rem', padding: '1rem', color: 'white', fontSize: '1.125rem', marginBottom: '1.5rem' }}>{userName}</div>
                  <div style={{ color: '#d1d5db', fontSize: '0.875rem', marginBottom: '0.5rem' }}>–ù–æ–≤–µ —ñ–º'—è</div>
                  <input autoFocus type="text" value={newName} onChange={e => setNewName(e.target.value)} placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–µ —ñ–º'—è" style={{ width: '100%', padding: '0.75rem 1rem', borderRadius: '0.25rem', border: 'none', color: 'black', marginBottom: '1rem', fontSize: '1.125rem' }} />
                  <div style={{ display: 'flex', gap: '0.75rem' }}>
                    <button onClick={handleChangeName} style={{ flex: 1, background: '#10b981', color: 'white', border: 'none', cursor: 'pointer', padding: '0.75rem', borderRadius: '0.25rem', fontSize: '1.125rem' }}>–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                    <button onClick={() => { setNewName(''); setView('main'); }} style={{ flex: 1, background: '#8a8a8a', color: 'white', border: 'none', cursor: 'pointer', padding: '0.75rem', borderRadius: '0.25rem', fontSize: '1.125rem' }}>–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                  </div>
                </>
              )}
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [page, setPage] = useState(() => localStorage.getItem('userName') ? 'planner' : 'login');
      const [userName, setUserName] = useState(() => localStorage.getItem('userName') || '');

      const handleLogin = (name) => { setUserName(name); setPage('planner'); };
      const handleNavigate = (p) => {
        if (p === 'login') { localStorage.clear(); setUserName(''); }
        setPage(p);
      };

      if (page === 'login') return <Login onLogin={handleLogin} />;
      if (page === 'planner') return <Planner userName={userName} onNavigate={handleNavigate} />;
      if (page === 'settings') return <Settings userName={userName} setUserName={setUserName} onNavigate={handleNavigate} />;
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
